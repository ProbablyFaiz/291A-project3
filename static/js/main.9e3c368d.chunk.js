(this.webpackJsonpchat_client=this.webpackJsonpchat_client||[]).push([[0],[,,,,,,,,,,,,,function(e,t,s){},function(e,t,s){},function(e,t,s){},,function(e,t,s){},function(e,t,s){},,function(e,t,s){"use strict";s.r(t);var a=s(2),n=s.n(a),r=s(8),i=s.n(r),c=(s(13),s(3)),o=s(4),u=s(1),d=s(6),l=s(5),h=(s(14),s(15),s(0)),j=function(e){Object(d.a)(s,e);var t=Object(l.a)(s);function s(e){var a;return Object(c.a)(this,s),(a=t.call(this,e)).state={url:e.url,message:"",token:e.token,formText:""},a.handleChange=a.handleChange.bind(Object(u.a)(a)),a.save=a.save.bind(Object(u.a)(a)),a}return Object(o.a)(s,[{key:"handleChange",value:function(e){this.setState({message:e.target.value})}},{key:"save",value:function(e){var t=this;e.preventDefault();var s=new FormData;s.append("message",this.state.message),this.setState({token:this.props.token}),console.log("compose save token: "+this.state.token),fetch(this.state.url+"/message",{method:"POST",headers:new Headers({Authorization:"Bearer "+this.state.token}),mode:"cors",body:s}).then((function(e){if(e.ok)return e.json();throw new Error(e.status)})).then((function(e){console.log("message sent successfully")})).catch((function(e){console.log("error: "+e),t.setState({requestFailed:!0})})),this.setState({message:""})}},{key:"render",value:function(){return Object(h.jsx)("div",{id:"compose",children:Object(h.jsx)("form",{className:"message",onSubmit:this.save,children:Object(h.jsx)("input",{id:"messageText",type:"text",value:this.state.message,onChange:this.handleChange})})})}}]),s}(a.Component),g=function(e){Object(d.a)(s,e);var t=Object(l.a)(s);function s(e){var a;return Object(c.a)(this,s),(a=t.call(this,e)).state={url:e.url,username:"",password:""},a.handleChange=a.handleChange.bind(Object(u.a)(a)),a.save=a.save.bind(Object(u.a)(a)),a}return Object(o.a)(s,[{key:"handleChange",value:function(e){"username"===e.target.id?this.setState({username:e.target.value}):"password"===e.target.id&&this.setState({password:e.target.value})}},{key:"save",value:function(e){var t=this,s=new URLSearchParams;s.append("username",this.state.username),s.append("password",this.state.password),e.preventDefault(),fetch(this.state.url+"/login",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},mode:"cors",body:s.toString()}).then((function(e){if(e.ok)return e.json();throw new Error(e.status)})).then((function(e){t.props.saveToken(e.token),t.props.loggedIn(),t.props.startStream()})).catch((function(e){console.log("error: "+e),t.setState({requestFailed:!0})}))}},{key:"render",value:function(){return Object(h.jsx)("div",{id:"login",children:Object(h.jsxs)("div",{children:[Object(h.jsx)("h2",{children:"Login"}),Object(h.jsxs)("form",{method:"post",onSubmit:this.save,children:[Object(h.jsxs)("label",{children:["Username ",Object(h.jsx)("br",{}),Object(h.jsx)("input",{id:"username",type:"text",onChange:this.handleChange})]}),Object(h.jsx)("br",{}),Object(h.jsxs)("label",{children:["Password ",Object(h.jsx)("br",{}),Object(h.jsx)("input",{id:"password",type:"password",onChange:this.handleChange})]}),Object(h.jsx)("br",{}),Object(h.jsx)("button",{type:"submit",children:"Submit"})]})]})})}}]),s}(a.Component),p=(s(17),function(e){Object(d.a)(s,e);var t=Object(l.a)(s);function s(e){var a;return Object(c.a)(this,s),(a=t.call(this,e)).state={displayMessages:e.displayMessages,messages:e.messages},a}return Object(o.a)(s,[{key:"componentDidUpdate",value:function(e){this.props.displayMessages!==e.displayMessages&&this.setState({displayMessages:this.props.displayMessages}),this.props.messages!==e.messages&&this.setState({messages:this.props.messages})}},{key:"render",value:function(){var e;return this.state.displayMessages&&(e=this.state.messages.map((function(e,t){return Object(h.jsx)("ul",{children:e},t)}))),Object(h.jsxs)("div",{className:"messageList",children:[Object(h.jsx)("p",{children:"Messages"}),e]})}}]),s}(a.Component)),b=(s(18),function(e){Object(d.a)(s,e);var t=Object(l.a)(s);function s(e){var a;return Object(c.a)(this,s),(a=t.call(this,e)).state={displayUsers:e.displayUsers,users:e.users},a}return Object(o.a)(s,[{key:"componentDidUpdate",value:function(e){this.props.displayUsers!==e.displayUsers&&this.setState({displayUsers:this.props.displayUsers}),this.props.users!==e.users&&this.setState({users:this.props.users})}},{key:"render",value:function(){var e;return this.state.displayUsers&&(e=this.state.users.map((function(e,t){return Object(h.jsx)("ul",{children:e},t)}))),Object(h.jsxs)("div",{className:"userList",children:[Object(h.jsx)("p",{children:"Online"}),e]})}}]),s}(a.Component)),m=function(e){Object(d.a)(s,e);var t=Object(l.a)(s);function s(e){var a;return Object(c.a)(this,s),(a=t.call(this,e)).state={url:sessionStorage.url||"https://chat.cs291.com",messages:[],users:[],displayUsersMessages:!1,displayLogin:!0,token:sessionStorage.accessToken||""},a.addUser=a.addUser.bind(Object(u.a)(a)),a.deleteUser=a.deleteUser.bind(Object(u.a)(a)),a.formatDate=a.formatDate.bind(Object(u.a)(a)),a.loggedIn=a.loggedIn.bind(Object(u.a)(a)),a.saveToken=a.saveToken.bind(Object(u.a)(a)),a.startStream=a.startStream.bind(Object(u.a)(a)),a}return Object(o.a)(s,[{key:"addUser",value:function(e){this.state.users.filter((function(t){return t===e})).length>0||this.setState((function(t){return{users:t.users.concat(e)}}))}},{key:"deleteUser",value:function(e){this.setState((function(t){return{users:t.users.filter((function(t){return t!==e}))}}))}},{key:"formatDate",value:function(e){var t=new Date(1e3*e);return new Intl.DateTimeFormat("en-US",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}).format(t)}},{key:"loggedIn",value:function(){this.setState({displayLogin:!1}),this.setState({displayUsersMessages:!0})}},{key:"saveToken",value:function(e){sessionStorage.accessToken=e,this.setState({token:e})}},{key:"startStream",value:function(){var e=this;this.eventSource=new EventSource(this.state.url+"/stream/"+sessionStorage.accessToken),this.eventSource.addEventListener("Disconnect",(function(t){e.eventSource.close(),delete sessionStorage.accessToken,e.setState({displayLogin:!0}),e.setState({displayUsersMessages:!1})}),!1),this.eventSource.addEventListener("Join",(function(t){var s=JSON.parse(t.data);e.addUser(s.user),e.setState((function(t){return{messages:t.messages.concat(e.formatDate(s.created)+" JOIN: "+s.user)}}))}),!1),this.eventSource.addEventListener("Message",(function(t){var s=JSON.parse(t.data);e.setState((function(t){return{messages:t.messages.concat(e.formatDate(s.created)+" ("+s.user+") "+s.message)}}))}),!1),this.eventSource.addEventListener("Part",(function(t){var s=JSON.parse(t.data);e.deleteUser(s.user),e.setState((function(t){return{messages:t.messages.concat(e.formatDate(s.created)+" PART: "+s.user)}}))}),!1),this.eventSource.addEventListener("ServerStatus",(function(t){var s=JSON.parse(t.data);e.setState((function(t){return{messages:t.messages.concat(e.formatDate(s.created)+" STATUS: "+s.status)}}))}),!1),this.eventSource.addEventListener("Users",(function(t){e.setState({displayLogin:!1}),e.setState({displayUsersMessages:!0}),e.setState({users:JSON.parse(t.data).users})}),!1),this.eventSource.addEventListener("error",(function(t){e.setState({displayUsersMessages:!1}),2===t.target.readyState?(delete sessionStorage.accessToken,e.setState({displayLogin:!0})):console.log("Disconnected, retrying")}),!1)}},{key:"render",value:function(){return this.state.displayLogin?Object(h.jsxs)("div",{className:"App",children:[Object(h.jsx)("br",{}),Object(h.jsx)("h3",{children:" Disconnected. "}),Object(h.jsx)("br",{}),Object(h.jsx)(g,{url:this.state.url,loggedIn:this.loggedIn,saveToken:this.saveToken,startStream:this.startStream})]}):Object(h.jsxs)("div",{className:"App",children:[Object(h.jsx)("br",{}),Object(h.jsx)("h3",{children:" Connected. "}),Object(h.jsx)("br",{}),Object(h.jsxs)("div",{className:"lists",children:[Object(h.jsx)("div",{class:"col-9",children:Object(h.jsx)(p,{displayMessages:this.state.displayUsersMessages,messages:this.state.messages})}),Object(h.jsx)("div",{class:"col-3",children:Object(h.jsx)(b,{displayUsers:this.state.displayUsersMessages,users:this.state.users})})]}),Object(h.jsx)("hr",{}),Object(h.jsx)(j,{url:this.state.url,token:this.state.token}),Object(h.jsx)("br",{})," ",Object(h.jsx)("br",{})]})}}]),s}(a.Component),v=function(e){e&&e instanceof Function&&s.e(3).then(s.bind(null,21)).then((function(t){var s=t.getCLS,a=t.getFID,n=t.getFCP,r=t.getLCP,i=t.getTTFB;s(e),a(e),n(e),r(e),i(e)}))};s(19);i.a.render(Object(h.jsx)(n.a.StrictMode,{children:Object(h.jsx)(m,{})}),document.getElementById("root")),v()}],[[20,1,2]]]);
//# sourceMappingURL=main.9e3c368d.chunk.js.map